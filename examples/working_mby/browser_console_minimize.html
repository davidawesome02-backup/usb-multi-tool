<head> <title>Uart console</title> <style>code{font-family:'Lucida Console',monospace;background-color:#000;color:#fff;white-space-collapse:preserve;font-size:1em;line-height:1.5em;padding:.25em 0}.code_background{background-color:#000}.top_part{margin:10px}body,html{margin:0;padding:0}</style> </head> <body> <div class="top_part"> <h1>Basic usb uart console</h1> <button onclick="connect()" id="connect_button">Connect</button> </div> <div class="code_background"> <code id="console_output"></code> </div> <script>function e(){connected=!0,document.getElementById("connect_button").innerHTML="clear",code_block.textContent="-- connected --"}function r(){return span=document.createElement("span"),span.style.color=last_span[1][0],span.style.backgroundColor=last_span[1][1],last_span[0]=span,code_block.appendChild(span),span}function n(e){null==last_span[0]&&r(),e.read().then((({done:r,value:o})=>{for(console.log(o),at_bottom=document.body.scrollHeight-visualViewport.height-window.scrollY<5,current_text_buffer=text_decoder.decode(o),i=0;i<current_text_buffer.length;i++)current_char=current_text_buffer[i],0!=current_parse_expression_buffer.length||"\x1b"==current_char?(current_parse_expression_buffer+=current_char,"\x1b"==current_char||"["==current_char||";"==current_char||current_char-0>=0||(t(),console.log(current_parse_expression_buffer,current_parse_expression_buffer.length,current_char),current_parse_expression_buffer="")):last_span[0].textContent+=current_char;at_bottom&&setTimeout((()=>{document.documentElement.scroll({behavior:"instant",top:document.documentElement.scrollHeight+10})}),10),n(e)}))}function t(){if(current_parse_expression_buffer.endsWith("m")){current_parse_expression_buffer=current_parse_expression_buffer.slice(2,-1),expression=current_parse_expression_buffer.split(";");for(let e in expression)expression[e]=expression[e]-0;1==expression.length&&(expression[0]>=90&&(expression[0]-=60),expression[0]<50&&(last_span[1][Math.floor((expression[0]-30)/10)]=["black","red","green","yellow","blue","magenta","cyan","white","",""][expression[0]%10]),39!=expression[0]&&0!=expression[0]||(last_span[1][0]="white"),49!=expression[0]&&0!=expression[0]||(last_span[0][0]="black")),5==expression.length&&(last_span[1][(expression[0]-38)/10]=`rgb(${expression[2]},${expression[3]},${expression[4]})`),r()}}function o(){connected?code_block.textContent="-- Cleared -- \n":navigator.serial.requestPort().then((r=>{text_decoder=new TextDecoder,r.open({baudRate:2e6}).then((()=>{e(),port_reader=r.readable.getReader(),n(port_reader)}))}))}connected=!1,current_parse_expression_buffer="",code_block=document.getElementById("console_output"),last_span=[null,["white","black"]],navigator.serial.getPorts().then((r=>{for(port_index in console.log(r),r)port=r[port_index],text_decoder=new TextDecoder,port.open({baudRate:2e6}).then((()=>{e(),port_reader=port.readable.getReader(),n(port_reader)}))})); </script> 